var db = database "links";
var factorials = table "factorials" with (i : Int, f : Int) from db;

fun blobOf(v) {
    dedup(for (x' <-- factorials) where (x'.f > 1) [v])
}

query {
    for (x1 <-- factorials)
    for (x2 <- dedup(for (z <- blobOf(x1)) [z]))
    for (x3 <- dedup(for (z1 <- blobOf(x1), z2 <- blobOf(x2)) [(i=z1.i, f=z2.f)]))
    for (x4 <- dedup(for (z1 <- blobOf(x1), z2 <- blobOf(x2), z3 <- blobOf(x3)) 
        [(i=z1.i, f=z3.f)]))
    where (x4.f <= x2.i)
    blobOf(x4)
}