sudo: required
dist: trusty
language: c
services:
  - postgresql
before_install:
  - sudo add-apt-repository -y ppa:avsm/ppa
  - sudo apt-get -qq update
  - sudo apt-get install -y ocaml-nox ocaml-native-compilers camlp4-extra opam
  - opam init -a
  - opam switch 4.04.0
  - eval `opam config env`
  - opam install -y postgresql
  - psql -c 'create database links;' -U postgres
after_failure:
  - echo "in after_failure"
  - cat /home/travis/.opam/4.04.0/build/links.0.7.1/*.env
  - cat /home/travis/.opam/4.04.0/build/links.0.7.1/*.out
  - cat /home/travis/.opam/4.04.0/build/links.0.7.1/*.err
script:
  - opam pin add links . -y
  - opam pin add links-postgresql . -y
  - make tests
  - ./run-tests db-only shredding
